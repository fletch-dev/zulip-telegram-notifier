# Бот для сообщений в telegram о новых сообщениях в Zulip

## Возможности

### Работа с Zulip:

- Пересылает текст сообщения
- Вставляет ссылку на сообщение в Zulip
- Учитывает mute стримов в Zulip (заглушенные топики нет возможности идентифицировать)
- Учитывает @mention логику Zulip

### Дополнительные возможности:

- часы для сна, когда сообшения в tg будут без уведомления
- принудительный silent-режим
- принудительный alert-режим – для уведомлений на все сообщения (например авария на проде в период сна)

### Технические возможности:

- Попытка обойти Rate Limit 429 для Zulip

## Инструкция для запуска

### Предварительная подготовка
- скопировать файл .env.example и переименовать его в .env (тут будут боевые переменные среды)

### Подготовка в подключению для Zulip

**Указать:**
- ZULIP_EMAIL – свой email Zulip в 
- ZULIP_SITE – адрес сервера Zulip в 
- ZULIP_API_KEY - ключ пользователя на сервере Zulip

**Как получить ключ:**
1. В правом верхнем углу нажать шестеренку и перейти в пункт Personal settings -> Account & Privacy (или по урлу https://<YOUR_ZULIP_SERVER>/#settings/account-and-privacy)
2. Пролистать вниз до раздела API key и нажать Managa your API key
3. Ввести пароль от Zulip (если не знаете пароль там есть кнопка восстановить, после восстановления введите его тут)
4. Увидеть и скопировать API-ключ

### Подготовка в подключению для Telegram

**Указать:**
- TELEGRAM_BOT_TOKEN – токен от бота, который будет слать сообщения
- TELEGRAM_CHAT_ID – идентификатор чата, в который будут приходить сообщения (бот должен быть доавлен в чат или нажато /start в ЛС с ботом, если хоите получать лично от бота)
- TELEGRAM_SILENT_FROM – с которого часа слать сообщения без уведомления
- TELEGRAM_SILENT_TO – по который час слать сообщения без уведомления
- TELEGRAM_FORCE_SILENT – все сообщения будут без уведомления (имеет преимущество над тихими часами)
- TELEGRAM_FORCE_ALARM – все сообщения будут с уведомлением (имеет преимущество над TELEGRAM_FORCE_SILENT)
- настроить остальные параметры в .env.prod под себя

**Как создать бота и получить токен:**
1. Открыть бота @BotFather
2. В меню выбрать "Create a new bot"
3. Ввести имя и username с окончанием на _bot
4. Нажать Create Bot
5. Выбрать бота в списке и нажать на заблюреный ключ, скопировать token бота

**Как получить идентификатор чата:**
1. Найти бота, который отдает информацию о чате (например @userinfobot)
2. Запустить его и получить свой идентификатор или добавить в чат и поулчить идентификатор чата

### Запуск

**Без контейнера:**
- создать файл .env.local и заполнить в нем поля из .env.example
- запустить bot.py

**В контейнере:**
- Для разработки можно запускать run-local.sh с параметрами в файле .env.local
- Для продакшн среды можно запускать run-prod.sh с параметрами в файле .env.prod

Таким образом, если для local и prod будут указаны разные креды для Zulip/Telegram, то они могут быть запущены пралаллельно на одном компьтере.
